<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro Temperature Frigoriferi â€” Laboratorio</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'><rect x='2' y='2' width='32' height='32' rx='8' fill='%231a5276'/><text x='18' y='25' text-anchor='middle' fill='white' font-size='20'>â„</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Source+Serif+4:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link rel="stylesheet" href="css/styles.css">
</head>
<body>

<header class="app-header">
  <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="2" y="2" width="36" height="36" rx="10" stroke="white" stroke-width="2" fill="none"/>
    <rect x="13" y="6" width="14" height="28" rx="3" stroke="white" stroke-width="1.8" fill="none"/>
    <line x1="16" y1="12" x2="24" y2="12" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
    <line x1="16" y1="17" x2="24" y2="17" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
    <circle cx="20" cy="24" r="3" stroke="white" stroke-width="1.5" fill="none"/>
    <line x1="20" y1="22" x2="20" y2="26" stroke="white" stroke-width="1.2" stroke-linecap="round"/>
  </svg>
  <div>
    <h1>Registro Temperature Frigoriferi</h1>
    <div class="subtitle">Monitoraggio giornaliero â€” Laboratorio Analisi</div>
  </div>
</header>

<div class="container">

  <!-- Month Selector -->
  <div class="month-selector">
    <button onclick="prevMonth()">â—€</button>
    <div id="month-display"></div>
    <button onclick="nextMonth()">â–¶</button>
  </div>

  <!-- TABS -->
  <div class="section-tabs">
    <button class="section-tab active" onclick="showSection('dashboard')">â‘  Dashboard</button>
    <button class="section-tab" onclick="showSection('data')">â‘¡ Inserimento Dati</button>
    <button class="section-tab" onclick="showSection('charts')">â‘¢ Grafici</button>
    <button class="section-tab" onclick="showSection('pdf')">â‘£ Report PDF</button>
    <button class="section-tab" onclick="showSection('settings')">â‘¤ Impostazioni</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="section-dashboard" class="fade-in">
    <div class="fridge-grid" id="fridge-cards"></div>
    <div style="text-align:center;margin-top:16px">
      <button class="btn btn-primary" onclick="showBatchModal()">ğŸ² Generazione Batch Temperature</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• DATA ENTRY â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="section-data" class="hidden">
    <div class="card">
      <div class="card-header">
        <div class="icon" style="background:var(--primary-pale);color:var(--primary)">ğŸŒ¡ï¸</div>
        <h2>Rilevazione Temperature</h2>
      </div>
      <div class="card-body" id="data-grid-container"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• CHARTS â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="section-charts" class="hidden">
    <div id="charts-container"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• PDF â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="section-pdf" class="hidden">
    <div class="card">
      <div class="card-header">
        <div class="icon" style="background:var(--accent-pale);color:var(--accent)">ğŸ“„</div>
        <h2>Genera Report Mensile PDF</h2>
      </div>
      <div class="card-body">
        <div id="pdf-preview-info"></div>
        <div class="grid-2" style="margin-bottom:16px">
          <div class="form-group"><label>Nome Laboratorio</label>
            <input type="text" id="lab-name" value="Laboratorio Analisi â€” P.O. Giovanni Paolo I"></div>
          <div class="form-group"><label>Note aggiuntive</label>
            <textarea id="pdf-notes-frigo" rows="2" placeholder="Note..."></textarea></div>
        </div>
        <div class="form-group" style="margin-bottom:16px">
          <label>Logo Intestazione</label>
          <div class="upload-zone" onclick="document.getElementById('logo-file').click()">
            <img id="header-preview" class="hidden" alt="Logo">
            <div id="upload-placeholder">ğŸ“· Clicca per caricare il logo</div>
            <input type="file" id="logo-file" accept="image/*" style="display:none" onchange="handleLogoUpload(event)">
          </div>
          <button class="btn btn-sm btn-outline" id="btn-remove-header" style="display:none;margin-top:6px" onclick="removeLogo()">Rimuovi logo</button>
        </div>
        <div id="lib-status" style="margin-bottom:16px"></div>
        <button class="btn btn-primary" onclick="generatePDF()">ğŸ“„ Genera e Scarica PDF</button>
        <div style="margin-top:24px"><h3 style="font-size:14px;color:var(--primary);margin-bottom:10px">ğŸ“ Report Archiviati</h3><div id="archive-list"></div></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â• SETTINGS â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="section-settings" class="hidden">
    <div class="card">
      <div class="card-header">
        <div class="icon" style="background:var(--accent-pale);color:var(--accent)">âš™ï¸</div>
        <h2>Configurazione Frigoriferi</h2>
      </div>
      <div class="card-body">
        <div class="btn-group" style="margin-bottom:16px">
          <button class="btn btn-primary" onclick="addNewFridge()">â• Aggiungi Frigorifero</button>
          <button class="btn btn-outline" onclick="resetFridges()">ğŸ”„ Ripristina predefiniti</button>
        </div>
        <div id="fridge-settings-list"></div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <div class="icon" style="background:var(--warning-pale);color:var(--warning)">ğŸ’¾</div>
        <h2>Gestione Dati</h2>
      </div>
      <div class="card-body">
        <div class="btn-group">
          <button class="btn btn-outline" onclick="exportData()">ğŸ“¤ Esporta (JSON)</button>
          <button class="btn btn-outline" onclick="document.getElementById('import-file').click()">ğŸ“¥ Importa</button>
          <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(event)">
          <button class="btn btn-danger-outline" onclick="clearAllData()">ğŸ—‘ï¸ Cancella tutti i dati</button>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• MODAL: Add Fridge â•â•â•â•â•â•â•â•â•â•â• -->
<div id="add-fridge-modal" class="modal-overlay hidden">
  <div class="modal-box" style="max-width:500px">
    <h3 style="margin-bottom:16px;color:var(--primary)">â• Nuovo Frigorifero</h3>
    <div class="form-group" style="margin-bottom:12px">
      <label>Nome</label>
      <input type="text" id="new-fridge-name" placeholder="es. Frigo 7 â€” Ematologia">
    </div>
    <div class="form-group" style="margin-bottom:12px">
      <label>Tipo</label>
      <select id="new-fridge-type" onchange="updateNewFridgeRangeUI()">
        <option value="+4">Frigorifero +4Â°C</option>
        <option value="-20">Congelatore -20Â°C</option>
        <option value="combo">Combinato (Frigo + Freezer)</option>
      </select>
    </div>
    <div id="new-fridge-range-fields" style="margin-bottom:16px"></div>
    <div class="btn-group">
      <button class="btn btn-primary" onclick="confirmAddFridge()">âœ… Aggiungi</button>
      <button class="btn btn-outline" onclick="document.getElementById('add-fridge-modal').classList.add('hidden')">Annulla</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â• MODAL: Batch Generator â•â•â•â•â•â•â•â•â•â•â• -->
<div id="batch-modal" class="modal-overlay hidden">
  <div class="modal-box" style="max-width:600px">
    <h3 style="margin-bottom:16px;color:var(--primary)">ğŸ² Generazione Batch Temperature</h3>
    <p style="font-size:13px;color:var(--text-secondary);margin-bottom:16px">
      Genera temperature casuali realistiche per piÃ¹ frigoriferi e piÃ¹ mesi/anni in un colpo solo.
    </p>

    <div class="form-group" style="margin-bottom:12px">
      <label>Frigoriferi</label>
      <div id="batch-fridge-checks" style="max-height:200px;overflow-y:auto;padding:8px;border:1px solid var(--border);border-radius:8px;display:flex;flex-direction:column;gap:4px;font-size:13px"></div>
    </div>

    <div class="grid-2" style="margin-bottom:12px">
      <div class="form-group"><label>Anno da</label>
        <input type="number" id="batch-year-from" min="2020" max="2040"></div>
      <div class="form-group"><label>Anno a</label>
        <input type="number" id="batch-year-to" min="2020" max="2040"></div>
    </div>
    <div class="grid-2" style="margin-bottom:12px">
      <div class="form-group"><label>Mese da</label>
        <select id="batch-month-from">
          <option value="0">Gennaio</option><option value="1">Febbraio</option>
          <option value="2">Marzo</option><option value="3">Aprile</option>
          <option value="4">Maggio</option><option value="5">Giugno</option>
          <option value="6">Luglio</option><option value="7">Agosto</option>
          <option value="8">Settembre</option><option value="9">Ottobre</option>
          <option value="10">Novembre</option><option value="11">Dicembre</option>
        </select>
      </div>
      <div class="form-group"><label>Mese a</label>
        <select id="batch-month-to">
          <option value="0">Gennaio</option><option value="1">Febbraio</option>
          <option value="2">Marzo</option><option value="3">Aprile</option>
          <option value="4">Maggio</option><option value="5">Giugno</option>
          <option value="6">Luglio</option><option value="7">Agosto</option>
          <option value="8">Settembre</option><option value="9">Ottobre</option>
          <option value="10">Novembre</option><option value="11" selected>Dicembre</option>
        </select>
      </div>
    </div>

    <div style="margin-bottom:16px">
      <label style="display:flex;gap:6px;align-items:center;font-size:13px">
        <input type="checkbox" id="batch-overwrite"> Sovrascrivi dati esistenti
      </label>
    </div>

    <div id="batch-progress" style="margin-bottom:16px"></div>

    <div class="btn-group">
      <button class="btn btn-primary" id="batch-go-btn" onclick="runBatchGeneration()">ğŸš€ Genera</button>
      <button class="btn btn-outline" onclick="hideBatchModal()">Chiudi</button>
    </div>
  </div>
</div>

<!-- JS -->
<script src="js/state.js"></script>
<script src="js/navigation.js"></script>
<script src="js/dashboard.js"></script>
<script src="js/data-entry.js"></script>
<script src="js/charts.js"></script>
<script src="js/pdf-generator.js"></script>
<script src="js/settings.js"></script>
<script src="js/init.js"></script>

</body>
</html>
